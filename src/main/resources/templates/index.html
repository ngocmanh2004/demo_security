<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{title.home}">Spring Security Demo - Trang ch·ªß</title>
    <link rel="stylesheet" href="/css/app.css?v=2">
</head>
<body>
<div class="navbar">
    <h1 th:text="#{{title.home}}">Spring Security Demo</h1>
    <div class="navbar-right">
        <div style="margin-right:8px; color:#e6eef8;">
            <a href="?lang=vi" style="margin-right:8px; color:#e6eef8;">VI</a>
            <a href="?lang=en" style="color:#e6eef8;">EN</a>
        </div>
        <div class="user-info" style="color:#e6eef8; margin-right:8px;">
            <span id="username"></span>
            <span id="role" style="font-size:13px; margin-left:6px; background:rgba(255,255,255,0.08); padding:2px 8px; border-radius:8px;"></span>
        </div>
        <button class="btn-logout" onclick="logout()" th:text="#{label.logout}">ƒêƒÉng xu·∫•t</button>
    </div>
</div>
<div class="hero">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h1 th:text="#{{title.home}}">Spring Security Demo</h1>
            <p class="subtitle">H·ªá th·ªëng qu·∫£n l√Ω s·∫£n ph·∫©m v·ªõi JWT Authentication</p>
        </div>
    </div>

    <div id="status" class="status"></div>

    <div class="features">
        <h3>T√≠nh nƒÉng</h3>
        <div class="feature-item">JWT Authentication (Access Token + Refresh Token)</div>
        <div class="feature-item">Ph√¢n quy·ªÅn User v√† Admin</div>
        <div class="feature-item">CRUD s·∫£n ph·∫©m (Admin only)</div>
        <div class="feature-item">Xem danh s√°ch s·∫£n ph·∫©m (All users)</div>
        <div class="feature-item">B·∫£o m·∫≠t v·ªõi BCrypt password</div>
        <div class="feature-item">RESTful API</div>
    </div>

    <div class="buttons" id="authButtons">
        <a href="login.html" class="btn btn-primary" th:text="#{label.login}">ƒêƒÉng nh·∫≠p</a>
        <a href="register.html" class="btn btn-secondary" th:text="#{title.register}">ƒêƒÉng k√Ω</a>
    </div>

    <div class="buttons" id="userButtons" style="display: none;">
        <a href="products.html" class="btn btn-primary">Xem s·∫£n ph·∫©m</a>
        <a href="admin.html" class="btn btn-primary" id="adminBtn" style="display: none;">Qu·∫£n l√Ω (Admin)</a>
        <button class="btn btn-secondary" onclick="logout()" th:text="#{label.logout}">ƒêƒÉng xu·∫•t</button>
    </div>
</div>

<script>
    // Check if user is logged in
        function checkAuth() {
            const token = localStorage.getItem('accessToken');
            const username = localStorage.getItem('username');
            const roles = JSON.parse(localStorage.getItem('roles') || '[]');
            let roleText = '';
            if (roles.includes('ROLE_ADMIN')) roleText = 'Admin';
            else if (roles.includes('ROLE_MANAGER')) roleText = 'Qu·∫£n l√Ω';
            else if (roles.includes('ROLE_USER')) roleText = 'Ng∆∞·ªùi d√πng';

            if (document.getElementById('username')) document.getElementById('username').textContent = username || '';
            if (document.getElementById('role')) document.getElementById('role').textContent = roleText;

            const statusDiv = document.getElementById('status');
            const authButtons = document.getElementById('authButtons');
            const userButtons = document.getElementById('userButtons');
            const adminBtn = document.getElementById('adminBtn');

            if (token && username) {
                statusDiv.className = 'status logged-in';
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = `üë§ Xin ch√†o, <strong>${username}</strong>! B·∫°n ƒëang ƒëƒÉng nh·∫≠p.`;

                authButtons.style.display = 'none';
                userButtons.style.display = 'flex';

                if (roles.includes('ROLE_ADMIN')) {
                    adminBtn.style.display = 'inline-block';
                }
            } else {
                statusDiv.className = 'status logged-out';
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = 'B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p.';
                authButtons.style.display = 'flex';
                userButtons.style.display = 'none';
                adminBtn.style.display = 'none';
            }
        }

    function logout() {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
            localStorage.clear();
            window.location.reload();
        }
    }

    // Check auth status on page load
    checkAuth();
</script>
</body>
</html>